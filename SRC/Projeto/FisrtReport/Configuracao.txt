sudo cp /opt/vyatta/etc/config.boot.default /config/config.boot
reboot


#Marketing:
ip 10.2.2.100/24 10.2.2.10

#Adm
ip 10.3.3.5/24 10.3.3.10

#Data Server
ip 10.4.4.100/24 10.4.4.10

#PC2
ip 200.2.2.100/24 200.2.2.10

#PC3:
ip 192.1.1.101/24 192.1.1.10

#Server:
ip 192.1.1.100/24 192.1.1.10

#Public Page:
ip 192.1.1.150/24 192.1.1.10



#R1
conf t
interface f0/0
ip address 10.1.1.10 255.255.255.0
no shutdown
interface f0/1
ip address 10.2.2.10 255.255.255.0
no shutdown
interface f1/0
ip address 10.3.3.10 255.255.255.0
no shutdown
interface f1/1
ip address 10.4.4.10 255.255.255.0
no shutdown

exit
ip route 0.0.0.0 0.0.0.0 10.1.1.1
ip route 0.0.0.0 0.0.0.0 10.1.1.2
end
write

 
#R2
conf t
interface f0/0
ip address 200.1.1.10 255.255.255.0
no shutdown
interface f0/1
ip address 200.2.2.10 255.255.255.0
no shutdown
exit
ip route 0.0.0.0 0.0.0.0 200.1.1.1
ip route 0.0.0.0 0.0.0.0 200.1.1.2
end
write


################################################
#Configure the Firewal
################################################
::::::::FW1:::::::::::::::::::::::::::
configure

set system host-name FW1

set interfaces ethernet eth0 address 10.0.3.1/24
set interfaces ethernet eth1 address 10.0.2.1/24
set interfaces ethernet eth2 address 10.0.1.1/24
set interfaces ethernet eth3 address 10.0.4.1/24
set interfaces ethernet eth4 address 10.0.9.1/24
commit
save
exit
show ip route


configure

set nat source rule 10 outbound-interface eth0
set nat source rule 10 source address 10.0.0.0/8
set nat source rule 10 translation address 192.1.0.1-192.1.0.10

set nat source rule 20 outbound-interface eth3
set nat source rule 20 source address 10.0.0.0/8
set nat source rule 20 translation address 192.1.0.1-192.1.0.10

set protocols static route 0.0.0.0/0 next-hop 10.0.3.10
set protocols static route 0.0.0.0/0 next-hop 10.0.4.10
set protocols static route 10.2.2.0/24 next-hop 10.0.1.10
set protocols static route 10.2.2.0/24 next-hop 10.0.2.10
set protocols static route 10.3.3.0/24 next-hop 10.0.1.10
set protocols static route 10.3.3.0/24 next-hop 10.0.2.10
set protocols static route 10.4.4.0/24 next-hop 10.0.1.10
set protocols static route 10.4.4.0/24 next-hop 10.0.2.10
set protocols static route 192.1.1.0/24 next-hop 10.0.9.2

set service ssh access-control allow user vyos
set service ssh listen-address 10.0.9.1
set service ssh port 22


--------------------------------------------------------------
			
--------------------------------------------------------------

set zone-policy zone INSIDE description "Inside (Internal Network)"
set zone-policy zone INSIDE interface eth1
set zone-policy zone INSIDE interface eth2

set zone-policy zone DMZ description "DMZ (Server Farm)"
set zone-policy zone DMZ interface eth4

set zone-policy zone OUTSIDE description "Outside (Internet)"
set zone-policy zone OUTSIDE interface eth0
set zone-policy zone OUTSIDE interface eth3

set zone-policy zone INSIDE from DMZ firewall name FROM-DMZ-TO-INSIDE
set zone-policy zone INSIDE from OUTSIDE firewall name FROM-OUTSIDE-TO-INSIDE

set zone-policy zone DMZ from INSIDE firewall name FROM-INSIDE-TO-DMZ
set zone-policy zone DMZ from OUTSIDE firewall name FROM-OUTSIDE-TO-DMZ

set zone-policy zone OUTSIDE from DMZ firewall name FROM-DMZ-TO-OUTSIDE
set zone-policy zone OUTSIDE from INSIDE firewall name FROM-INSIDE-TO-OUTSIDE



--------------------------------------------------------------------
::::::::FW2:::::::::::::::::::::::::::

configure

set system host-name FW2

set interfaces ethernet eth0 address 10.0.5.1/24
set interfaces ethernet eth1 address 10.0.6.1/24
set interfaces ethernet eth2 address 10.0.7.1/24
set interfaces ethernet eth3 address 10.0.8.1/24
set interfaces ethernet eth4 address 10.0.11.1/24
commit
save
exit
show ip route

-------------------------------------------------------------
-------------------------------------------------------------
configure

set nat source rule 10 outbound-interface eth0
set nat source rule 10 source address 10.0.0.0/8
set nat source rule 10 translation address 192.1.0.1-192.1.0.10

set nat source rule 20 outbound-interface eth3
set nat source rule 20 source address 10.0.0.0/8
set nat source rule 20 translation address 192.1.0.1-192.1.0.10

set protocols static route 0.0.0.0/0 next-hop 10.0.5.10
set protocols static route 0.0.0.0/0 next-hop 10.0.8.10
set protocols static route 10.2.2.0/24 next-hop 10.0.6.10
set protocols static route 10.2.2.0/24 next-hop 10.0.7.10
set protocols static route 10.3.3.0/24 next-hop 10.0.6.10
set protocols static route 10.3.3.0/24 next-hop 10.0.7.10
set protocols static route 10.4.4.0/24 next-hop 10.0.6.10
set protocols static route 10.4.4.0/24 next-hop 10.0.7.10
set protocols static route 192.1.1.0/24 next-hop 10.0.11.2

set service ssh access-control allow user vyos
set service ssh listen-address 10.0.11.1
set service ssh port 22

-------------------------------------------------------------------
##########Ver Isso
### For both FW1 and FW2

set zone-policy zone INSIDE description "Inside (Internal Network)"
set zone-policy zone INSIDE interface eth1
set zone-policy zone INSIDE interface eth2

set zone-policy zone DMZ description "DMZ (Server Farm)"
set zone-policy zone DMZ interface eth4

set zone-policy zone OUTSIDE description "Outside (Internet)"
set zone-policy zone OUTSIDE interface eth0
set zone-policy zone OUTSIDE interface eth3

set zone-policy zone INSIDE from DMZ firewall name FROM-DMZ-TO-INSIDE
set zone-policy zone INSIDE from OUTSIDE firewall name FROM-OUTSIDE-TO-INSIDE

set zone-policy zone DMZ from INSIDE firewall name FROM-INSIDE-TO-DMZ
set zone-policy zone DMZ from OUTSIDE firewall name FROM-OUTSIDE-TO-DMZ

set zone-policy zone OUTSIDE from DMZ firewall name FROM-DMZ-TO-OUTSIDE
set zone-policy zone OUTSIDE from INSIDE firewall name FROM-INSIDE-TO-OUTSIDE
------------------------------------------------------------------------
			LBS
------------------------------------------------------------------------
#LB1:

configure 

set system host-name LB1A

set interfaces ethernet eth0 address 10.1.1.1/24
set interfaces ethernet eth1 address 10.0.6.10/24
set interfaces ethernet eth2 address 10.0.1.10/24 
set interfaces ethernet eth5 address 10.0.0.1/24

set protocols static route 10.2.2.0/24 next-hop 10.1.1.10
set protocols static route 10.3.3.0/24 next-hop 10.1.1.10
set protocols static route 10.4.4.0/24 next-hop 10.1.1.10


set load-balancing wan interface-health eth1 nexthop 10.0.6.1
set load-balancing wan interface-health eth2 nexthop 10.0.1.1
set load-balancing wan rule 1 inbound-interface eth0
set load-balancing wan rule 1 interface eth1 weight 1
set load-balancing wan rule 1 interface eth2 weight 1
set load-balancing wan sticky-connections inbound
set load-balancing wan disable-source-nat

set high-availability vrrp group LB1Cluster vrid 1
set high-availability vrrp group LB1Cluster interface eth5
set high-availability vrrp group LB1Cluster virtual-address 10.0.0.1/24             
set high-availability vrrp sync-group LB1Cluster member LB1Cluster
set high-availability vrrp group LB1Cluster rfc3768-compatibility
set service conntrack-sync accept-protocol 'tcp,udp,icmp'
set service conntrack-sync failover-mechanism vrrp sync-group LB1Cluster
set service conntrack-sync interface eth5
set service conntrack-sync mcast-group 225.0.0.50
set service conntrack-sync disable-external-cache
commit
save

:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
LB1B:

configure

set system host-name LB1B

set interfaces ethernet eth0 address 10.1.1.2/24
set interfaces ethernet eth1 address 10.0.7.10/24
set interfaces ethernet eth2 address 10.0.2.10/24
set interfaces ethernet eth5 address 10.0.0.2/24

set protocols static route 10.2.2.0/24 next-hop 10.1.1.10
set protocols static route 10.3.3.0/24 next-hop 10.1.1.10
set protocols static route 10.4.4.0/24 next-hop 10.1.1.10

set load-balancing wan interface-health eth1 nexthop 10.0.7.1
set load-balancing wan interface-health eth2 nexthop 10.0.2.1
set load-balancing wan rule 1 inbound-interface eth0
set load-balancing wan rule 1 interface eth1 weight 1
set load-balancing wan rule 1 interface eth2 weight 1
set load-balancing wan sticky-connections inbound
set load-balancing wan disable-source-nat

set high-availability vrrp group LB1Cluster vrid 1
set high-availability vrrp group LB1Cluster interface eth5
set high-availability vrrp group LB1Cluster virtual-address 10.0.0.1/24             
set high-availability vrrp sync-group LB1Cluster member LB1Cluster
set high-availability vrrp group LB1Cluster rfc3768-compatibility
set service conntrack-sync accept-protocol 'tcp,udp,icmp'
set service conntrack-sync failover-mechanism vrrp sync-group LB1Cluster
set service conntrack-sync interface eth5
set service conntrack-sync mcast-group 225.0.0.50
set service conntrack-sync disable-external-cache
commit
save
-----------------------------------------------------------------------
-----------------------------------------------------------------------

LB2:

configure

set system host-name LB2A

set interfaces ethernet eth0 address 200.1.1.1/24
set interfaces ethernet eth1 address 10.0.8.10/24
set interfaces ethernet eth2 address 10.0.3.10/24 
set interfaces ethernet eth5 address 10.0.10.1/24
 

set protocols static route 200.2.2.0/24 next-hop 200.1.1.10

set load-balancing wan interface-health eth1 nexthop 10.0.8.1
set load-balancing wan interface-health eth2 nexthop 10.0.3.1
set load-balancing wan rule 1 inbound-interface eth0
set load-balancing wan rule 1 interface eth1 weight 1
set load-balancing wan rule 1 interface eth2 weight 1
set load-balancing wan sticky-connections inbound
set load-balancing wan disable-source-nat

set high-availability vrrp group LB2Cluster vrid 1
set high-availability vrrp group LB2Cluster interface eth5
set high-availability vrrp group LB2Cluster virtual-address 192.168.100.1/24           
set high-availability vrrp sync-group LB2Cluster member LB2Cluster
set high-availability vrrp group LB2Cluster rfc3768-compatibility
set service conntrack-sync accept-protocol 'tcp,udp,icmp'
set service conntrack-sync failover-mechanism vrrp sync-group LB2Cluster
set service conntrack-sync interface eth5
set service conntrack-sync mcast-group 225.0.0.50
set service conntrack-sync disable-external-cache
commit
save

:::::::::::::::::::::::::::::::::::::::::::::::::
LB2B:

configure

set system host-name LB2B

set interfaces ethernet eth0 address 200.1.1.2/24
set interfaces ethernet eth1 address 10.0.5.10/24
set interfaces ethernet eth2 address 10.0.4.10/24
set interfaces ethernet eth5 address 10.0.10.2/24

set protocols static route 200.2.2.0/24 next-hop 200.1.1.10

set load-balancing wan interface-health eth1 nexthop 10.0.5.1
set load-balancing wan interface-health eth2 nexthop 10.0.4.1
set load-balancing wan rule 1 inbound-interface eth0
set load-balancing wan rule 1 interface eth1 weight 1
set load-balancing wan rule 1 interface eth2 weight 1
set load-balancing wan sticky-connections inbound
set load-balancing wan disable-source-nat

set high-availability vrrp group LB2Cluster vrid 1
set high-availability vrrp group LB2Cluster interface eth5
set high-availability vrrp group LB2Cluster virtual-address 192.168.100.1/24            
set high-availability vrrp sync-group LB2Cluster member LB2Cluster
set high-availability vrrp group LB2Cluster rfc3768-compatibility
set service conntrack-sync accept-protocol 'tcp,udp,icmp'
set service conntrack-sync failover-mechanism vrrp sync-group LB2Cluster
set service conntrack-sync interface eth5
set service conntrack-sync mcast-group 225.0.0.50
set service conntrack-sync disable-external-cache
commit
save


::::::::::::::::::::::::::::::::::
LBDMZ:
configure

set system host-name LBDMZ

set interfaces ethernet eth0 address 10.0.9.2/24
set interfaces ethernet eth1 address 10.0.11.2/24
set interfaces ethernet eth2 address 192.1.1.10/24

set load-balancing wan disable-source-nat
set load-balancing wan interface-health eth0 nexthop 10.0.9.1
set load-balancing wan interface-health eth1 nexthop 10.0.11.1
set load-balancing wan rule 1 inbound-interface eth2
set load-balancing wan rule 1 interface eth0 weight 1
set load-balancing wan rule 1 interface eth1 weight 1
set load-balancing wan rule 1 protocol all
set load-balancing wan sticky-connections inbound

-----------------------------------
IPS dos FW: 
Fw1:
eth0: 10.0.3.1/24
eth1: 10.0.2.1/24
eth2: 10.0.1.1/24
eth3: 10.0.4.1/24
eth4: 10.0.9.1/24

FW2: 
eth0: 10.0.5.1/24
eth1: 10.0.6.1/24
eth2: 10.0.7.1/24
eth3: 10.0.8.1/24
eth4: 10.0.11.1/24
-----------------------------------
Ips dos LB1:
LB1A
eth0: 10.1.1.1/24
eth1: 10.0.6.10/24
eth2: 10.0.1.10/24 
eth5: 10.0.0.1/24

LB1B
eth0: 10.1.1.2/24
eth1: 10.0.7.10/24
eth2: 10.0.2.10/24
eth5: 10.0.0.2/24
::::::::::::::::::::::::
LB2A
eth0: 200.1.1.1/24
eth1: 10.0.8.10/24
eth2: 10.0.3.10/24 
eth5: 10.0.10.1/24

LB2B
eth0: 200.1.1.2/24
eth1: 10.0.5.10/24
eth2: 10.0.4.10/24
eth5: 10.0.10.2/24

LBDMZ:
eth0: 10.0.9.2/24
eth1: 10.0.11.2/24
eth2: 192.1.1.10/24
-------------------------------
Ips dos Ruters
R1:
F0/0: 10.1.1.10/24
F0/1: 10.2.2.10/24
F1/0: 10.3.3.10/24
F1/1: 10.4.4.10/24

R2:
F0/0: 200.1.1.10/24
F0/1: 200.2.2.10/24
--------------------------------
Ips dos PC

Marketing: 10.2.2.100/24
Admin: 10.3.3.5/24
Desing: 10.4.4.100/24

PC2: 200.2.2.100/24

PC3: 192.1.1.101/24
Sever: 192.1.1.100/24
Public Page: 192.1.1.150/24


cat /etc/contracto/conntrack.one


Já feitas: 
TODOS

######################################
#R3
conf t
interface f0/0
ip address 10.0.9.10 255.255.255.0
no shutdown
interface f0/1
ip address 192.1.1.10 255.255.255.0
no shutdown
exit
ip route 0.0.0.0 0.0.0.0 10.0.9.2
end 
write

-- ip route 0.0.0.0 0.0.0.0 10.0.9.1 : perguntar o professor. 

ip route 192.1.0.0 255.255.254.0 200.1.1.1




show conntrack table ipv4
show wan-load-balance status
show nat source translations
